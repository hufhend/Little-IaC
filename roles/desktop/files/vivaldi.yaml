# Vivaldi browser - Snap installation (official recommended method)
- name: Set Vivaldi variables
  ansible.builtin.set_fact:
    app: "vivaldi"
    app_name: "Vivaldi"

- name: Install Vivaldi via Snap
  block:
    - name: Ensure Snap is installed
      ansible.builtin.package:
        name: snapd
        state: present

    - name: Install Vivaldi browser
      community.general.snap:
        name: "{{ app }}"
        state: present
        classic: true
  when: 
    - vivaldi == True
    - ansible_facts['os_family'] == "Debian"

- name: Install Vivaldi on RedHat/Fedora via Flatpak
  block:
    - name: Ensure Flatpak is installed
      ansible.builtin.package:
        name: flatpak
        state: present

    - name: Add Flathub repository
      community.general.flatpak_remote:
        name: flathub
        flatpakrepo_url: https://dl.flathub.org/repo/flathub.flatpakrepo
        state: present

    - name: Install Vivaldi browser via Flatpak
      community.general.flatpak:
        name: com.vivaldi.Vivaldi
        state: present
        method: system
  when:
    - vivaldi == True
    - ansible_facts['os_family'] == "RedHat"