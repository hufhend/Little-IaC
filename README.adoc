= Ansible scripts for setting up Linux
Václav Dvorský <hufhendr@gmail.com>
1.1, 25 April, 2022: Ansible readme
:toc:
:icons: font
:url-quickref: https://github.com/hufhend/ansible

These scripts were originally created as Ansible exercises. Later, they focused on automating Linux setup before installing a Kubernetes cluster. 

WARNING: The intended use is on a new bare metal installation of Linux, deployment on already running machines could be problematic.

== Quick Start

* First we clone the repository
+
`+git clone https://github.com/hufhend/ansible.git+`

* All playbooks and roles are relative is the root directory _ansible_, we enter it.
+
`+cd ansible+`

* Copy the sample variables, modify them as needed
+
`+cp -rfp sample/* .+`

* And simply run the first playbook 
+
`+ansible-playbook -i inventory.yaml -l node06 setup.yaml+`

TIP: I recommend to try the functions in a non-production environment, for example via Vagrant.

== First launch
Before the first launch, we need to assign a new computer and user to run Ansible. A special playbook and roles are used for this.

=== Playbook host_init 
After a clean Linux installation, we usually have one regular user with sudo privileges. This is usually enough for us to manage the system from the command line, but for Ansible we need additional settings.
The host_init role sets the default user to run Ansible, uploads the ssh keys, adds it to sudoers, and sets the hostname.

==== Usage

`+ansible-playbook -i inventory.yaml -l host07 host-init.yaml -kK+`

== Features of playbooks

=== Desktop

The goal of this playbook is to turn a regular Ubuntu for desktop or laptop into a much better tuned system. At the same time connected to IAC automation and more manageable remotely.

The playbook is simple and easy to read.

Usage:

`+ansible-playbook -i inventory.yaml -l notebook desktop.yaml+`

== Detailed description

.Common parameters
|===
|Name |Description|Default value

|`+docker_user+`
|user for the docker role
|`+ansible_user+`

|`+role+`
|node role in the cluster: master or worker
|`+computer+`

|`+firewall+`
|decides whether to turn on the firewall
|`+false+`

|`+desktop+`
|determines if the computer is used by a human
|`+false+`


|`+cron+`
|enables crontab setting at K8s value
|`+choose+`

|`+orange+`
|enabling roles for ARM single board computers
|`+false+`

|===

The default setting of the _comuter_ role causes tasks from the cluster_node to not be executed. The required value should be set in host_vars.

.Docker app parameters
|===
|Name |Description|Default value
|`+docker_home+`
|directory for Docker applications
|`+docker+`

|`+gitea+`
|deploy the app gitea
|`+false+`

|`+pihole+`
|deploy the app pi-hole
|`+false+`

|`+prometheus+`
|deploy the app prometheus
|`+false+`
|===

== Newly added features

5 May 2024 

* Added functionality to insert crontabs into K8s nodes, basic disk health check and update underlying systems including restart for maintenance
* Added example host_vars
* Add additional tasks for the crontab, they will only run if they are defined. See the example for details.

7 May 2024

* Added role for laptops or desktop computers with GUI on Ubuntu Linux. It is simple but functional.

9 May 2024

* Major redesign of firewall rules, added cluster rules and special guest rules. See examples. 
* Today is 3 months since I started learning Ansible. The first playbook was created in the neighboring repo https://github.com/hufhend/ubuntu-postinstall/commit/a4bc32693bae647deb433bd07dd1b3ef54a51f99[ubuntu-postinstall].

_To be continued_

// This is a paragraph with a *bold* word and an _italicized_ word.

// .Image caption
// image::image-file-name.png[I am the image alt text.]

// This is another paragraph.footnote:[I am footnote text and will be displayed at the bottom of the article.]

// === Second level heading

// .Unordered list title
// * list item 1
// ** nested list item
// *** nested nested list item 1
// *** nested nested list item 2
// * list item 2

// This is a paragraph.

// .Example block title
// ====
// Content in an example block is subject to normal substitutions.
// ====

// .Sidebar title
// ****
// Sidebars contain aside text and are subject to normal substitutions.
// ****

// ==== Third level heading

// [#id-for-listing-block]
// .Listing block title
// ----
// Content in a listing block is subject to verbatim substitutions.
// Listing block content is commonly used to preserve code input.
// ----

// ===== Fourth level heading

// .Table title
// |===
// |Column heading 1 |Column heading 2

// |Column 1, row 1
// |Column 2, row 1

// |Column 1, row 2
// |Column 2, row 2
// |===

// ====== Fifth level heading

// [quote, firstname lastname, movie title]
// ____
// I am a block quote or a prose excerpt.
// I am subject to normal substitutions.
// ____

// [verse, firstname lastname, poem title and more]
// ____
// I am a verse block.
//   Indents and endlines are preserved in verse blocks.
// ____

// == First level heading

// TIP: There are five admonition labels: Tip, Note, Important, Caution and Warning.

// // I am a comment and won't be rendered.

// . ordered list item
// .. nested ordered list item
// . ordered list item

// The text at the end of this sentence is cross referenced to <<_third_level_heading,the third level heading>>

// == First level heading

// This is a link to the https://docs.asciidoctor.org/home/[Asciidoctor documentation].
// This is an attribute reference {url-quickref}[that links this text to the AsciiDoc Syntax Quick Reference].